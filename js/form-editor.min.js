!function(epdfGf,undefined){jQuery(document).on("gform_field_added",(function(event,form,field){loadPdfViewerFieldEditorSettings(field)})),void 0!==gform.addAction&&gform.addAction("gform_post_load_field_settings",(function(field,form){loadPdfViewerFieldEditorSettings(field[0])}),10,2);const{__:__}=wp.i18n;var controller=new AbortController;function isValidHttpUrl(string){let url;try{url=new URL(string)}catch(_){return!1}return"http:"===url.protocol||"https:"===url.protocol}function loadPdfViewerFieldEditorSettings(field){if(epdf_gf_form_editor_strings.field_type===field.type){var elements=[];elements.push(document.getElementById("field_initial_scale"));var keys=[];keys.push("initialScale"),elements[0]&&(elements[0].value=rgar(field,keys[0]),["input","propertychange"].forEach((function(e){elements[0].addEventListener(e,(function(){SetFieldProperty(keys[0],this.value)}))})),elements[0].dispatchEvent(new Event("input"))),elements.push(document.getElementById("field_pdf_url")),keys.push("pdfUrl"),elements[1]&&(elements[1].value=rgar(field,keys[1]),["input","propertychange"].forEach((function(e){elements[1].addEventListener(e,(function(){if(SetFieldProperty(keys[1],this.value),""!==this.value)if(isValidHttpUrl(this.value)){if(epdf_gf_form_editor_strings.site_url!==this.value.substring(0,epdf_gf_form_editor_strings.site_url.length)){var msg=__("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-gravityforms")+'<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+__("Learn about CORS →","embed-pdf-gravityforms")+"</a>";return"1"===epdf_gf_form_editor_strings.can_upload_files&&(msg+='<p><button id="download_pdf_media" class="gform-button gform-button--white">'+__("Download PDF into Media Library","embed-pdf-gravityforms")+"</button></p>"),setFieldError("pdf_url_setting","below",msg),void("1"===epdf_gf_form_editor_strings.can_upload_files&&document.querySelector("#download_pdf_media").addEventListener("click",handleDownloadClick))}resetFieldError("pdf_url_setting"),controller.abort(),localFileExists(this.value).then((exists=>exists?resetFieldError("pdf_url_setting"):setFieldError("pdf_url_setting","below",__("No file exists at the provided URL.","embed-pdf-gravityforms"))))}else setFieldError("pdf_url_setting","below",__("Please enter a valid URL.","embed-pdf-gravityforms"));else resetFieldError("pdf_url_setting")}))})),elements[1].dispatchEvent(new Event("input"))),elements.push(document.getElementById("choose_pdf_url")),elements[2]&&(elements[2].removeEventListener("click",epdfGf.handleChooseClick),elements[2].addEventListener("click",epdfGf.handleChooseClick))}}const localFileExists=file=>{if(epdf_gf_form_editor_strings.site_url!==file.substring(0,epdf_gf_form_editor_strings.site_url.length))return Promise.resolve(!1);controller=new AbortController;return fetch(file,{method:"HEAD",cache:"no-store",credentials:"omit",signal:controller.signal}).then((response=>200===response.status&&response.url===file)).catch((exception=>!1))};function handleDownloadClick(e){e.preventDefault();var url=document.getElementById("field_pdf_url").value;if(isValidHttpUrl(url))return fetch(epdf_gf_form_editor_strings.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"download_pdf_media",_ajax_nonce:epdf_gf_form_editor_strings.nonce,url:url}).toString()}).then((response=>response.json())).then((responseObj=>{if(responseObj)if(responseObj.data.url&&isValidHttpUrl(responseObj.data.url??""))document.getElementById("field_pdf_url").value=responseObj.data.url,SetFieldProperty("pdfUrl",responseObj.data.url),resetFieldError("pdf_url_setting");else if(!responseObj.success&&responseObj.data.msg)return void setFieldError("pdf_url_setting","below",responseObj.data.msg)})).catch((error=>{console.error("[Embed PDF for Gravity Forms] Download failed."),console.error(error)})),!1;setFieldError("pdf_url_setting","below",__("Please enter a valid URL.","embed-pdf-gravityforms"))}epdfGf.handleChooseClick=function(e){if("1"===epdf_gf_form_editor_strings.can_upload_files){if(e.preventDefault(),void 0!==wp.media){var file_frame=wp.media.frames.file_frame=wp.media({title:__("Choose PDF","embed-pdf-gravityforms"),button:{text:__("Load","embed-pdf-gravityforms")},frame:"select",multiple:!1});return file_frame.on("select",(function(){var attachment=file_frame.state().get("selection").first().toJSON(),urlEl=document.getElementById("field_pdf_url");urlEl||(urlEl=document.getElementById("url_pdf")),urlEl&&attachment.url&&(urlEl.value=attachment.url,urlEl.dispatchEvent(new Event("input")))})),file_frame.open(),!1}console.error("[Embed PDF for Gravity Forms] wp.media is undefined.")}else setFieldError("pdf_url_setting","below",__("Sorry, you do not have access to the Media Library.","embed-pdf-gravityforms"))}}(window.epdfGf=window.epdfGf||{});