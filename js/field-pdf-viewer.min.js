function handleChooseClick(e){e.preventDefault();const{__:t}=wp.i18n;var n=wp.media.frames.file_frame=wp.media({title:t("Choose PDF","embed-pdf-gravityforms"),button:{text:t("Load","embed-pdf-gravityforms")},frame:"select",multiple:!1});return n.on("select",(function(){var e=n.state().get("selection").first().toJSON(),t=document.getElementById("field_pdf_url");t||(t=document.getElementById("url_pdf")),t&&e.url&&(t.value=e.url,t.dispatchEvent(new Event("input")))})),n.open(),!1}function isValidHttpUrl(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}function renderPage(e,t){e.pageRendering=!0,e.pdfDoc.getPage(t).then((function(t){var n=t.getViewport({scale:e.pdfDoc.currentScaleValue});e.canvas.height=n.height,e.canvas.width=n.width;var a={canvasContext:e.canvas.getContext("2d"),viewport:n};t.render(a).promise.then((function(){e.pageRendering=!1,null!==e.pageNumPending&&(renderPage(e,e.pageNumPending),e.pageNumPending=null),e.canvas.style.width="100%",e.canvas.style.width=e.canvas.width+"px";const t=new CustomEvent("epgf_render_page",{detail:e.pageNum});window.dispatchEvent(t)}))})),document.getElementById(e.canvasId+"_page_num").textContent=t}function queueRenderPage(e){e.pageRendering?e.pageNumPending=e.pageNum:renderPage(e,e.pageNum)}function onPrevPage(e){var t=window["epgf_"+e.target.dataset.viewerId];t.pageNum<=1||(t.pageNum--,queueRenderPage(t),togglePrevNextButtons(t))}function onNextPage(e){var t=window["epgf_"+e.target.dataset.viewerId];t.pageNum>=t.pdfDoc.numPages||(t.pageNum++,queueRenderPage(t),togglePrevNextButtons(t))}function togglePrevNextButtons(e){document.getElementById(e.canvasId+"_prev").disabled=1==e.pageNum,document.getElementById(e.canvasId+"_next").disabled=e.pageNum==e.pdfDoc.numPages}function scaleDeltaDefault(){return 1.1}function scaleMin(){return.25}function scaleMax(){return 10}function onZoomIn(e){var t=window["epgf_"+e.target.dataset.viewerId];let n=t.pdfDoc.currentScaleValue;n=(n*scaleDeltaDefault()).toFixed(2),n=Math.ceil(10*n)/10,n=Math.min(scaleMax(),n),t.pdfDoc.currentScaleValue=n,renderPage(t,t.pageNum);const a=new CustomEvent("epgf_scale_value",{detail:n});window.dispatchEvent(a)}function onZoomOut(e){var t=window["epgf_"+e.target.dataset.viewerId];let n=t.pdfDoc.currentScaleValue;n=(n/scaleDeltaDefault()).toFixed(2),n=Math.floor(10*n)/10,n=Math.max(scaleMin(),n),t.pdfDoc.currentScaleValue=n,renderPage(t,t.pageNum);const a=new CustomEvent("epgf_scale_value",{detail:n});window.dispatchEvent(a)}function loadPreview(e,t){var n=window["epgf_"+e],a="field_"+t+"_"+e;""!==n.urlPdf&&pdfjsLib.getDocument({url:n.urlPdf,verbosity:0}).promise.then((function(e){n.pdfDoc&&n.pdfDoc.destroy(),n.pdfDoc=e,document.getElementById(n.canvasId+"_page_count").textContent=n.pdfDoc.numPages,n.pdfDoc.currentScaleValue=n.initialScale,n.canvas.style.width="100%",renderPage(n,n.pageNum),togglePrevNextButtons(n)})).catch((function(e){console.log(e);const t=document.querySelector("#"+a+" .ginput_container_pdf_viewer");if(t&&e.message){const{__:a}=wp.i18n;var n="<p><b>"+a("PDF Viewer Error:","embed-pdf-gravityforms")+"</b> "+e.message;epdf_gf_pdfjs_strings.is_user_logged_in&&(n+=' <a href="https://breakfastco.xyz/embed-pdf-for-gravity-forms/#troubleshooting">'+a("Troubleshooting →","embed-pdf-gravityforms")+"</a>"),n+="</p>",t.innerHTML+=n}document.querySelectorAll("#"+a+" .epgf-controls-container, #"+a+" .epdf-container").forEach((function(e){e.style.display="none"}))}))}gform.addAction("gform_post_load_field_settings",(function(e,t){if("pdf_viewer"===e[0].type){var n={field_initial_scale:"initialScale",field_pdf_url:"pdfUrl"};Object.keys(n).forEach((t=>{var a=document.getElementById(t);a&&(a.value=rgar(e[0],n[t]),["input","propertychange"].forEach((function(e){a.addEventListener(e,(function(){if(SetFieldProperty(n[t],this.value),"field_pdf_url"===t){if(""===this.value)return void resetFieldError("pdf_url_setting");if(isValidHttpUrl(this.value))if(epdf_gf_pdf_viewer_strings.site_url!==this.value.substring(0,epdf_gf_pdf_viewer_strings.site_url.length)){const{__:e}=wp.i18n;setFieldError("pdf_url_setting","below",e("Only PDFs hosted by this website and other websites listing this website in a CORS header ‘Access-Control-Allow-Origin’ can load in the viewer.","embed-pdf-gravityforms")+'<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">'+e("Learn about CORS →","embed-pdf-gravityforms")+"</a>")}else resetFieldError("pdf_url_setting");else{const{__:e}=wp.i18n;setFieldError("pdf_url_setting","below",e("Please enter a valid URL.","embed-pdf-gravityforms"))}}}))})),a.dispatchEvent(new Event("input")))})),el=document.getElementById("choose_pdf_url"),el&&(el.removeEventListener("click",handleChooseClick),el.addEventListener("click",handleChooseClick))}}),10,2),window.addEventListener("load",(function(e){"undefined"!=typeof pdfjsLib&&(pdfjsLib.GlobalWorkerOptions.workerSrc=epdf_gf_pdfjs_strings.url_worker)}));