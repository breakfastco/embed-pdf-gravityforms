!function(epdfGf,undefined){function canvasElement(fieldId,formId){return document.querySelector(".epdf-container canvas.epdf#field_"+formId+"_"+fieldId+"_embed_pdf_gravityforms")}function queueRenderPage(epdfInstance){"true"===epdfInstance.dataset.pageRendering?epdfInstance.dataset.pageNumPending=epdfInstance.dataset.pageNum:renderPage(epdfInstance,Number(epdfInstance.dataset.pageNum))}function renderPage(epdfInstance,pageNum){isNaN(Number(pageNum))&&(pageNum=1),epdfInstance.dataset.pageRendering=!0,window.epdf_gf[epdfInstance.dataset.field].pdfDoc.getPage(pageNum).then((function(page){var viewport=page.getViewport({scale:window.epdf_gf[epdfInstance.dataset.field].pdfDoc.currentScaleValue});epdfInstance.height=viewport.height,epdfInstance.width=viewport.width;var renderContext={canvasContext:epdfInstance.getContext("2d"),viewport:viewport};page.render(renderContext).promise.then((function(){epdfInstance.dataset.pageRendering=!1,""!==epdfInstance.dataset.pageNumPending&&(renderPage(epdfInstance,Number(epdfInstance.dataset.pageNumPending)),epdfInstance.dataset.pageNumPending=""),epdfInstance.style.width="100%",epdfInstance.style.width=epdfInstance.width+"px";const event=new CustomEvent("epdf_gf_render_page",{detail:epdfInstance.dataset.pageNum});window.dispatchEvent(event)}))})),document.getElementById(epdfInstance.id+"_page_num").textContent=pageNum}function togglePrevNextButtons(epdfInstance){document.getElementById(epdfInstance.id+"_prev").disabled=1==epdfInstance.dataset.pageNum,document.getElementById(epdfInstance.id+"_next").disabled=epdfInstance.dataset.pageNum==window.epdf_gf[epdfInstance.dataset.field].pdfDoc.numPages}window.addEventListener("load",(function(e){if("undefined"!=typeof pdfjsLib){pdfjsLib.GlobalWorkerOptions.workerSrc=epdf_gf_pdfjs_strings.url_worker;const event=new CustomEvent("epdf_gf_pdfjs_worker_set");window.dispatchEvent(event)}})),window.addEventListener("epdf_gf_pdfjs_worker_set",(function(e){window.epdf_gf={},document.querySelectorAll(".epdf-container canvas.epdf").forEach((function(el){window.epdf_gf[el.dataset.field]={},function(fieldId,formId){var epdfInstance=canvasElement(fieldId,formId),fieldElementId="field_"+formId+"_"+fieldId;if(void 0===epdfInstance)return void(epdf_gf_pdf_viewer_strings.script_debug&&console.log("[Embed PDF for Gravity Forms] loadPreview( "+fieldId+" ) failed, spin up data missing"));var urlEl=document.getElementById("input_"+formId+"_"+fieldId);if(null===urlEl||""===urlEl.value)return void(epdf_gf_pdf_viewer_strings.script_debug&&console.log("[Embed PDF for Gravity Forms] loadPreview( "+fieldId+" ) failed, no PDF URL"));const controls={prev:"onPrevPage",next:"onNextPage",zoom_in:"onZoomIn",zoom_out:"onZoomOut"};Object.keys(controls).forEach((function(key,index){var el=document.getElementById(epdfInstance.id+"_"+key);el&&el.addEventListener("click",epdfGf[controls[key]])})),pdfjsLib.getDocument({url:urlEl.value,verbosity:0}).promise.then((function(pdfDoc_){window.epdf_gf[fieldId].pdfDoc&&window.epdf_gf[fieldId].pdfDoc.destroy(),window.epdf_gf[fieldId].pdfDoc=pdfDoc_,document.getElementById(epdfInstance.id+"_page_count").textContent=window.epdf_gf[fieldId].pdfDoc.numPages,window.epdf_gf[fieldId].pdfDoc.currentScaleValue=epdfInstance.dataset.initialScale,epdfInstance.style.width="100%",renderPage(epdfInstance,Number(epdfInstance.dataset.pageNum)),togglePrevNextButtons(epdfInstance)})).catch((function(error){epdf_gf_pdf_viewer_strings.script_debug&&(console.log("[Embed PDF for Gravity Forms]"),console.log(error));const el=document.querySelector("#"+fieldElementId+" .ginput_container_pdf_viewer");if(el&&error.message){const{__:__}=wp.i18n;var msg="<p><b>"+__("PDF Viewer Error:","embed-pdf-gravityforms")+"</b> "+error.message;epdf_gf_pdfjs_strings.is_user_logged_in&&(msg+=' <a href="https://breakfastco.xyz/embed-pdf-for-gravity-forms/#troubleshooting">'+__("Troubleshooting â†’","embed-pdf-gravityforms")+"</a>"),msg+="</p>",el.innerHTML+=msg}document.querySelectorAll("#"+fieldElementId+" .epdf-controls-container, #"+fieldElementId+" .epdf-container").forEach((function(el){el.style.display="none"}))}))}(el.dataset.field,el.dataset.form)}))})),epdfGf.onPrevPage=function(e){var epdfInstance=canvasElement(e.target.dataset.field,e.target.dataset.form);Number(epdfInstance.dataset.pageNum)<=1||(epdfInstance.dataset.pageNum--,queueRenderPage(epdfInstance),togglePrevNextButtons(epdfInstance))},epdfGf.onNextPage=function(e){var epdfInstance=canvasElement(e.target.dataset.field,e.target.dataset.form);Number(epdfInstance.dataset.pageNum)>=window.epdf_gf[e.target.dataset.field].pdfDoc.numPages||(epdfInstance.dataset.pageNum++,queueRenderPage(epdfInstance),togglePrevNextButtons(epdfInstance))},epdfGf.onZoomIn=function(e){var epdfInstance=canvasElement(e.target.dataset.field,e.target.dataset.form);let newScale=window.epdf_gf[e.target.dataset.field].pdfDoc.currentScaleValue;newScale=(1.1*newScale).toFixed(2),newScale=Math.ceil(10*newScale)/10,newScale=Math.min(10,newScale),window.epdf_gf[e.target.dataset.field].pdfDoc.currentScaleValue=newScale,renderPage(epdfInstance,Number(epdfInstance.dataset.pageNum));const event=new CustomEvent("epdf_gf_scale_value",{detail:newScale});window.dispatchEvent(event)},epdfGf.onZoomOut=function(e){var epdfInstance=canvasElement(e.target.dataset.field,e.target.dataset.form);let newScale=window.epdf_gf[e.target.dataset.field].pdfDoc.currentScaleValue;newScale=(newScale/1.1).toFixed(2),newScale=Math.floor(10*newScale)/10,newScale=Math.max(.25,newScale),window.epdf_gf[e.target.dataset.field].pdfDoc.currentScaleValue=newScale,renderPage(epdfInstance,Number(epdfInstance.dataset.pageNum));const event=new CustomEvent("epdf_gf_scale_value",{detail:newScale});window.dispatchEvent(event)}}(window.epdfGf=window.epdfGf||{});